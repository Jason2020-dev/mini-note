<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>手机记事本</title>
<style>
/* ===== 基础 ===== */
*{box-sizing:border-box}
body{display:flex;margin:0;height:100vh;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif}
#topBar{position:fixed;top:6px;right:6px;z-index:101;display:flex;gap:6px}
#topBar button{background:#007aff;color:#fff;border:none;padding:6px 10px;border-radius:4px}
#toggle{position:fixed;top:6px;left:6px;z-index:101;background:#007aff;color:#fff;border:none;padding:6px 10px;border-radius:4px}

/* ===== 编辑区 ===== */
#main{flex:1;display:flex;flex-direction:column;padding-top:40px}
textarea{flex:1;border:none;padding:15px;font-size:18px;resize:none;outline:none}

/* ===== 抽屉 ===== */
#drawer{position:fixed;top:0;left:0;width:80%;max-width:280px;height:80%;background:#111;color:#fff;overflow-y:auto;transform:translateX(-100%);transition:transform .3s;z-index:100;border-radius:0 8px 8px 0}
#drawer.show{transform:translateX(0)}
#drawer h3{margin:0;padding:10px;font-size:16px;border-bottom:1px solid #333}
#docList{list-style:none;margin:0;padding:0}
#docList li{padding:10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
#docList li.active{background:#007aff}
#docList li span{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#docList li button{background:none;border:none;color:#ff3b30;font-size:18px;padding:0 6px}
#newDoc{width:100%;border:none;background:#007aff;color:#fff;padding:10px}

/* ===== 遮罩层 ===== */
#overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:99}
#overlay.show{display:block}

/* ===== 电脑端：并排显示 ===== */
@media (min-width:768px){
  #main{padding-top:0;padding-left:290px}
  #drawer{position:absolute;top:0;left:0;height:100%;max-width:280px;border-radius:0;transform:none!important}
  #toggle,#overlay{display:none}
}
#rename{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border:1px solid #ccc;padding:6px 10px;font-size:16px;width:160px;border-radius:4px;z-index:200}
</style>
</head>
<body>

<button id="toggle">☰</button>
<div id="topBar"><button id="saveBtn">💾 导出</button></div>

<!-- 遮罩 -->
<div id="overlay"></div>

<!-- 抽屉 -->
<nav id="drawer">
  <h3>📒 笔记列表</h3>
  <ul id="docList"></ul>
  <button id="newDoc">＋ 新建笔记</button>
</nav>

<!-- 主体 -->
<div id="main">
  <textarea id="txt" placeholder="开始输入…"></textarea>
</div>

<input id="rename" type="text"/>

<script>
/* ===== 数据 ===== */
const LS_KEY = 'notes_v1';
let notes = JSON.parse(localStorage.getItem(LS_KEY)) || {curr:'默认笔记',data:{'默认笔记':''}};
function saveNotes(){ localStorage.setItem(LS_KEY,JSON.stringify(notes)); }

/* ===== 元素 ===== */
const drawer = document.getElementById('drawer');
const overlay = document.getElementById('overlay');
const toggle = document.getElementById('toggle');
const txt = document.getElementById('txt');
const list = document.getElementById('docList');
const renameBox = document.getElementById('rename');

/* ===== 打开/关闭抽屉 ===== */
function openDrawer(){ drawer.classList.add('show'); overlay.classList.add('show'); }
function closeDrawer(){ drawer.classList.remove('show'); overlay.classList.remove('show'); }
toggle.addEventListener('click',openDrawer);
overlay.addEventListener('click',closeDrawer);

/* ===== 列表渲染 ===== */
function renderList(){
  list.innerHTML = '';
  for(const name in notes.data){
    const li = document.createElement('li');
    if(name === notes.curr) li.classList.add('active');
    li.innerHTML = `<span>${name}</span><button title="删除">×</button>`;
    li.querySelector('span').ondblclick = e=>{e.stopPropagation();startRename(name);};
    li.querySelector('button').onclick = e=>{e.stopPropagation();delDoc(name);};
    li.onclick = ()=>{ switchDoc(name); closeDrawer(); };
    list.appendChild(li);
  }
}
function switchDoc(name){
  notes.data[notes.curr] = txt.value;
  notes.curr = name;
  txt.value = notes.data[name] || '';
  saveNotes(); renderList();
}
function newDoc(){
  let name = '笔记 ' + (Object.keys(notes.data).length+1);
  notes.data[name] = '';
  switchDoc(name);
}
function delDoc(name){
  if(Object.keys(notes.data).length===1){ alert('至少保留一篇笔记'); return; }
  if(!confirm(`删除「${name}」？`)) return;
  delete notes.data[name];
  switchDoc(Object.keys(notes.data)[0]);
}
function startRename(oldName){
  renameBox.value = oldName;
  renameBox.style.display = 'block';
  renameBox.focus();
  renameBox.select();
  renameBox.onblur = renameBox.onkeydown = e=>{
    if(e.type==='keydown' && e.key!=='Enter') return;
    const n = renameBox.value.trim();
    if(n && n!==oldName && !notes.data[n]){
      notes.data[n] = notes.data[oldName];
      delete notes.data[oldName];
      notes.curr = n;
      saveNotes(); renderList();
    }
    renameBox.style.display = 'none';
  };
}
document.getElementById('newDoc').addEventListener('click',()=>{ newDoc(); closeDrawer(); });

/* ===== 导出 ===== */
document.getElementById('saveBtn').addEventListener('click',()=>{
  const blob = new Blob([txt.value], {type:'text/plain;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = notes.curr + '_' + new Date().toLocaleString().replace(/[:/\s]/g,'-') + '.txt';
  a.click();
});

/* ===== 初始化 ===== */
txt.value = notes.data[notes.curr] || '';
txt.addEventListener('input',()=>{ notes.data[notes.curr]=txt.value; saveNotes(); });
renderList();
</script>
</body>
</html>